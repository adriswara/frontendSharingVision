<!DOCTYPE html>
<html>

<head>
    <title>Edit Post</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
</head>

<body class="bg-light">
    <div class="container mt-5">
        <h2 class="mb-4">Edit Post</h2>
        <form id="editForm" class="mb-3">
            <div class="mb-3">
                <label for="title" class="form-label">Title:</label>
                <input type="text" id="title" class="form-control" required>
            </div>
            <div class="mb-3">
                <label for="status" class="form-label">Current Status:</label>
                <input type="text" id="status" class="form-control" readonly>
                <br>
                <button type="button" class="btn btn-sm btn-primary" onclick="setStatus('Published')">Publish</button> <button type="button"
                    class="btn btn-sm btn-warning" onclick="setStatus('Draft')">Draft</button> <button type="button"
                    class="btn btn-sm btn-danger" onclick="setStatus('Trashed')"><i class="bi bi-trash"></i></button>

            </div>
            <div class="mb-3">
                <label for="content" class="form-label">Content:</label>
                <textarea id="content" class="form-control" rows="4" required></textarea>
            </div>
            <div class="mb-3">
                <label for="category" class="form-label">Category:</label>
                <input type="text" id="category" class="form-control" required>
            </div>
            <button type="submit" class="btn btn-primary">Update</button>
            <a href="index.html" class="btn btn-secondary ms-2">Back</a>
        </form>
        <div id="message"></div>
    </div>
    <script>
        // Get post ID from URL: edit.html?id=123
        function getPostId() {
            const params = new URLSearchParams(window.location.search);
            return params.get('id');
        }

        const postId = getPostId();
        if (!postId) {
            document.getElementById('message').innerHTML = '<div class="alert alert-danger">No post ID provided.</div>';
            document.getElementById('editForm').style.display = 'none';
        } else {
            // Fetch post data and fill form
            fetch(`http://127.0.0.1:8081/posts/${postId}`)
                .then(response => response.json())
                .then(post => {
                    document.getElementById('title').value = post.title || '';
                    document.getElementById('status').value = post.status || 'draft';
                    document.getElementById('content').value = post.content || '';
                    document.getElementById('category').value = post.category || '';
                })
                .catch(() => {
                    document.getElementById('message').innerHTML = '<div class="alert alert-danger">Failed to load post data.</div>';
                    document.getElementById('editForm').style.display = 'none';
                });

            // Handle form submit
            document.getElementById('editForm').addEventListener('submit', function (e) {
                e.preventDefault();
                const postData = {
                    title: document.getElementById('title').value,
                    status: document.getElementById('status').value,
                    content: document.getElementById('content').value,
                    category: document.getElementById('category').value,
                    created_date: new Date().toISOString()
                };
                fetch(`http://127.0.0.1:8081/posts/${postId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(postData)
                })
                    .then(response => {
                        if (response.ok) {
                            document.getElementById('message').innerHTML = '<div class="alert alert-success">Post updated successfully!</div>';
                            setTimeout(() => window.location.href = 'index.html', 1000);
                        } else {
                            document.getElementById('message').innerHTML = '<div class="alert alert-danger">Failed to update post.</div>';
                        }
                    })
                    .catch(() => {
                        document.getElementById('message').innerHTML = '<div class="alert alert-danger">Error connecting to server.</div>';
                    });
            });
        }
        function setStatus(newStatus) {
            document.getElementById('status').value = newStatus;
        }
    </script>
</body>

</html>